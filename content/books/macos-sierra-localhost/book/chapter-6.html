
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebooks - Building a Development Environment in MacOS Sierra - Apache Virtual Hosts</title>
    <link rel="stylesheet" href="../../../../assets/css/app.css">
    <link href='https://cdn.jsdelivr.net/devicons/1.8.0/css/devicons.min.css' rel='stylesheet'>
    <!--<link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/master/devicon.min.css">-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body class="innerpage chapter-6">

<header class="row">
    <!--<div class="small-2 columns">
                <a href="../../../../index.html">    
                    <img class="logo" src="../../../../assets/img/robo-1.png"  alt="company logo">
                </a>            </div>-->
    <div class="small-10 columns">
        <div class="" id="name-slogan"> 
            <h1 class="name"><a href="../../../../index.html">SMERTH</a><ul class="inline-list social">
           <li><a href="#"><i class="fi-social-facebook"></i></a></li>
           <li><a href="#"><i class="fi-social-twitter"></i></a></li>
           <li><a href="#"><i class="fi-social-linkedin"></i></a></li>
           <li><a href="#"><i class="fi-social-github"></i></a></li>
        </ul></h1>
        <p class="tagline">Full-stack Web Developer</p>
            <h2 class="slogan">building with <span class="percent">100%</span> re-cycled electrons.</h2>
        </div>
    </div>
    <div class="small-12 columns responsive-menu">
        <div class="title-bar" data-responsive-toggle="main-menu" data-hide-for="medium">
            <button class="menu-icon" type="button" data-toggle></button>
            <div class="title-bar-title">Menu</div>
        </div>
        <div class="top-bar" id="main-menu">
            <div class="top-bar-left">
                <ul class="menu vertical medium-horizontal collapsed medium-text-center" data-responsive-menu="accordion medium-dropdown"
                    data-accordion-menu>
                    <li class="menu-text"><a href="../../../../index.html">Hello</a></li>
                    <li><a href="../../../../projects.html">Projects</a></li>
                    <li><a href="../../../../content/books/books.html">Notes</a></li>
                    <li><a href="../../../../screenshots.html">Screenshots</a></li>
                    <li><a href="../../../../about/book/chapter-1.html">About</a></li>
                    <li><a href="../../../../timeline.html">Timeline</a></li>
                    <!--<li><a href="../../../../hp-singlepage-scroll.html">fpage scroll</a></li>
                    <li><a href="../../../../hp-desk-foundation.html">desk foundation</a></li>-->                </ul>
            </div>
            <div class="top-bar-right">
                <!--<ul class="inline-list social">
   <li><a href="#"><i class="fi-social-facebook"></i></a></li>
   <li><a href="#"><i class="fi-social-twitter"></i></a></li>
   <li><a href="#"><i class="fi-social-linkedin"></i></a></li>
   <li><a href="#"><i class="fi-social-github"></i></a></li>
</ul>-->
            </div>
        </div>
    </div>
</header>
                    


<div class="row Building a Development Environment in MacOS Sierra" data-sticky-container>
        <div id="chapter-sticky-header" class="column small-12 sticky" data-sticky data-anchor="main" data-options="marginTop:0;" style="width: 100%;">
        <div class="callout">
            <div class="row">
                <div class="column small-6 small-order-2 medium-order-1 medium-3 prev-container">
                                        <h6><a class="prev" href="./chapter-5.html"><i class="fi-arrow-left"></i> Previous<div><small>Chapter 5 - MySQL</small></div></a></h6>
                                    </div> 
                <div class="column small-12 small-order-1 medium-order-2 medium-6 text-center title-container">
                    <div class="row">
                        <div class="small-3 medium-5 columns">
                                                        <a href="../../../../../index.html">
                                <h4 class="name">SMERTH</h4>
                            </a>
                        </div>
                        <div class="columns medium-7">
                            <h6 id="apache-virtual-hosts" class="bk-title text-left">
                                <i class="fi-book-bookmark"> </i>
                                <a href="./index.html">Building a Development Environment in MacOS Sierra</a>
                            </h6>
                            <h6 id="apache-virtual-hosts" class="ch-title text-left"><small>Chapter 6 - Apache Virtual Hosts</small></h6>
                        </div>
                    </div>
                </div> 
                <div class="column small-6 small-order-3 medium-order-3 medium-3 next-container">
                                            <h6><a class="next" href="./chapter-7.html"><div class="text-right">Next <i class="fi-arrow-right"></i></div><div class="text-right"><small>Chapter 7 - PHP Exentions</small></div></a></h6>
                                    </div>

            </div>         </div>     </div> </div> 
<div id="book-page" class="Building a Development Environment in MacOS Sierra row">
  


 
    <div  class="column small-12 medium-4 large-3" >



<div id="sidebar" data-sticky-container>

                        
        <div class="callout" data-sticky data-anchor="main" data-options="marginTop:6.3;" style="width:100%">
            <nav id="sidebar-toc" >
                <h3><a href=".">Table of contents</a></h3>
                <ul class="toc">
                                                                                        <li class="level-1">
                            <span class="chapter-label">1.</span> <a href="./chapter-1.html"> Package Mangers and Toolsets</a>
                        </li>
                                                                                                            <li class="level-1">
                            <span class="chapter-label">2.</span> <a href="./chapter-2.html"> Editors and Packages</a>
                        </li>
                                                                                                            <li class="level-1">
                            <span class="chapter-label">3.</span> <a href="./chapter-3.html"> Apache Installation</a>
                        </li>
                                                                                                            <li class="level-1">
                            <span class="chapter-label">4.</span> <a href="./chapter-4.html"> PHP Installation</a>
                        </li>
                                                                                                            <li class="level-1">
                            <span class="chapter-label">5.</span> <a href="./chapter-5.html"> MySQL</a>
                        </li>
                                                                                                    <li class="level-1 active">
                        <a class="chapter" href="./chapter-6.html"><span class="chapter-label">Chapter 6.</span>Apache Virtual Hosts</a>
                        <ul id="page-toc" class="unstyled toc-l2">
                                                                                            <li class="level-2" data-scroll="virtual-hosts">
                                    <span class="chapter-sub-label">6.1</span>
                                    <a class="internal" href="./chapter-6.html#virtual-hosts">Virtual Hosts</a>
                                </li>
                                                                <li class="level-2" data-scroll="dnsmasq">
                                    <span class="chapter-sub-label">6.2</span>
                                    <a class="internal" href="./chapter-6.html#dnsmasq">Dnsmasq</a>
                                </li>
                                                                                    </ul>
                    </li>
                                                                                                            <li class="level-1">
                            <span class="chapter-label">7.</span> <a href="./chapter-7.html"> PHP Exentions</a>
                        </li>
                                                                                                            <li class="level-1">
                            <span class="chapter-label">8.</span> <a href="./chapter-8.html"> Drupal DevOps</a>
                        </li>
                                                        </ul>             </nav>         </div> 
</div>

    </div> 
        <div id="main" class="main column small-12 medium-8 large-9 ">
        <div class="callout">
            <div class="main-content">

                                                                 <p>A very handy development option is to have multiple virtual hosts set up for your various projects. This means that you can set up names such as <code>project-x.mydomain.com</code> for a project-specific URL.</p>

<p>Apache generally performs name-based matching, so you don't need to configure multiple IP addresses. Detailed information can be found on the <code>apache.org</code> site.</p>

<h2 id="virtual-hosts">6.1 Virtual Hosts</h2>

<p>Apache already comes preconfigured to support this behavior but it is not enabled. First you will need to uncomment the following lines in: <code>/usr/local/etc/apache2/2.4/httpd.conf</code></p>

<div class="code code">
<pre class="code">LoadModule vhost_alias_module libexec/mod_vhost_alias.so</pre>
</div>

<p>and:</p>

<div class="code code">
<pre class="code"># Virtual Hosts
Include /usr/local/etc/apache2/2.4/extra/httpd-vhosts.conf</pre>
</div>

<p>Then you can edit this referenced file and configure it to your needs.</p>

<p>@ .bashrc</p>

<div class="code code">
<pre class="code"># Manage Virtual Hosts
alias conf_vhosts=&quot;sublime /private/etc/hosts &amp;&amp; sublime /usr/local/etc/apache2/2.4/extra/httpd-vhosts.conf&quot;</pre>
</div>

<p>This file has some instructions already but the important thing to remember is that these rules are matched in order.</p>

<p>When you set up virtual hosts, you will lose your older document root, so you will need to add back support for that first as a virtual host.</p>

<p>@ httpd-vhosts.conf</p>

<div class="code code">
<pre class="code">&lt;VirtualHost *:80&gt;
    DocumentRoot &quot;/Users/your_user/Sites&quot;
    ServerName localhost
&lt;/VirtualHost&gt;
&nbsp;
&lt;VirtualHost *:80&gt;
    DocumentRoot &quot;/Users/your_user/Sites/this-site&quot;
    ServerName this-site.com
&lt;/VirtualHost&gt;</pre>
</div>

<p>This just lets you know that the source directory listed for your virtual hosts is not present on the drive. It's an issue that can be resolved by editing this file with the corrected DocumentRoot.</p>

<h2 id="dnsmasq">6.2 Dnsmasq</h2>

<p><strong>Note</strong> - not implemented on my server</p>

<p>In the example virtualhost we setup above, we defined a ServerName of <code>this-site.com</code>.</p>

<p>This by default will not resolve to your local machine.  Make it so by manually adding entries to <code>/etc/hosts</code> every time you define a new server for a new site.</p>

<p>@ hosts</p>

<div class="code code">
<pre class="code">127.0.0.1    this-site.com
127.0.0.1    www.this-site.com</pre>
</div>

<p>However when managing a large number of sites this becomes tedious.</p>

<p>One option is to install and configure Dnsmasq to automatically handle wildcard <code>*.dev</code> names and forward all of them to localhost (127.0.0.1).</p>

<p>First we install it with brew:</p>

<div class="code bash">
<pre class="bash">brew <span class="kw2">install</span> dnsmasq</pre>
</div>

<p>To configure dnsmasq, copy the example configuration to /usr/local/etc/dnsmasq.conf
and edit to taste.</p>

<div class="code bash">
<pre class="bash"><span class="kw2">cp</span> <span class="sy0">/</span>usr<span class="sy0">/</span>local<span class="sy0">/</span>opt<span class="sy0">/</span>dnsmasq<span class="sy0">/</span>dnsmasq.conf.example <span class="sy0">/</span>usr<span class="sy0">/</span>local<span class="sy0">/</span>etc<span class="sy0">/</span>dnsmasq.conf</pre>
</div>

<p>Then we setup <code>*.dev</code> hosts:</p>

<p>Add dnsmasq.conf to the conf_hosts definition</p>

<p>@.bashrc</p>

<div class="code code">
<pre class="code"># Manage Virtual Hosts
alias conf_vhosts=&quot;sublime /private/etc/hosts &amp;&amp; sublime /usr/local/etc/apache2/2.4/extra/httpd-vhosts.conf &amp;&amp; /usr/local/etc/dnsmasq.conf&quot;</pre>
</div>

<p>edit dnsmasq.conf</p>

<div class="code bash">
<pre class="bash"><span class="kw3">echo</span> <span class="st_h">'address=/.dev/127.0.0.1'</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>usr<span class="sy0">/</span>local<span class="sy0">/</span>etc<span class="sy0">/</span>dnsmasq.conf</pre>
</div>

<p>Start it and ensure it auto-starts on reboot in the future:</p>

<div class="code bash">
<pre class="bash"><span class="kw2">sudo</span> brew services start dnsmasq</pre>
</div>

<p>And lastly, add it to the resolvers:</p>

<div class="code bash">
<pre class="bash"><span class="kw2">sudo</span> <span class="kw2">mkdir</span> <span class="re5">-v</span> <span class="sy0">/</span>etc<span class="sy0">/</span>resolver
<span class="kw2">sudo</span> <span class="kw2">bash</span> <span class="re5">-c</span> <span class="st_h">'echo &quot;nameserver 127.0.0.1&quot; &gt; /etc/resolver/dev'</span></pre>
</div>

<p>Now you can test it out by pinging some <code>bogus.dev</code> name:</p>

<div class="code bash">
<pre class="bash"><span class="kw2">ping</span> bogus.dev</pre>
</div>

<p>returns:</p>

<div class="code bash">
<pre class="bash">PING bogus.dev <span class="br0">&#40;</span>127.0.0.1<span class="br0">&#41;</span>: <span class="nu0">56</span> data bytes
<span class="nu0">64</span> bytes from 127.0.0.1: <span class="re2">icmp_seq</span>=<span class="nu0">0</span> <span class="re2">ttl</span>=<span class="nu0">64</span> <span class="re2">time</span>=<span class="nu0">0.044</span> ms
<span class="nu0">64</span> bytes from 127.0.0.1: <span class="re2">icmp_seq</span>=<span class="nu0">1</span> <span class="re2">ttl</span>=<span class="nu0">64</span> <span class="re2">time</span>=<span class="nu0">0.118</span> ms
<span class="nu0">64</span> bytes from 127.0.0.1: <span class="re2">icmp_seq</span>=<span class="nu0">2</span> <span class="re2">ttl</span>=<span class="nu0">64</span> <span class="re2">time</span>=<span class="nu0">0.045</span> ms</pre>
</div>

<p>Voila! we have successfully setup wildcard forwarding of all <code>*.dev</code> DNS names to localhost.</p>

                            </div>
        </div>
    </div> 
</div> 
<footer class="row">
    <div class="columns medium-12 topspace">

        <div class=" footer-top align-right text-right">
            <p class="copywrite">Copywrite © 2017</p>
        </div>

        <div class="footer-middle">
            <div class="row">
                <div class="small-12 medium-6 large-4 columns">
                    <a href="../../../../index.html">    
                        <img class="logo" src="../../../../assets/img/robo-1.png"  alt="company logo">
                    </a>                    <div class="" id="name-slogan"> 
                        <h1 class="name"><a href="../../../../index.html">SMERTH</a><ul class="inline-list social">
                       <li><a href="#"><i class="fi-social-facebook"></i></a></li>
                       <li><a href="#"><i class="fi-social-twitter"></i></a></li>
                       <li><a href="#"><i class="fi-social-linkedin"></i></a></li>
                       <li><a href="#"><i class="fi-social-github"></i></a></li>
                    </ul></h1>
                    <p class="tagline">Full-stack Web Developer</p>
                        <h2 class="slogan">building with <span class="percent">100%</span> re-cycled electrons.</h2>
                    </div>
                    <ul class="footer-menu no-bullet inline-dot-list">
                        <li><a href="../../../../projects.html">Projects</a></li>
                        <li><a href="../../../../content/books/books.html">Notes</a></li>
                        <li><a href="../../../../screenshots.html">Screenshots</a></li>
                        <li><a href="../../../../about/book/chapter-1.html">About</a></li>
                        <li><a href="../../../../timeline.html">Timeline</a></li>
                        <!--<li><a href="../../../../hp-singlepage-scroll.html">fpage scroll</a></li>
                        <li><a href="../../../../hp-desk-foundation.html">desk foundation</a></li>-->                    </ul>
                </div>
                <div class="small-12 medium-6 large-4 columns align-middle">
                    <ul class="contact">
                      <li><p><i class="fi-marker"></i>address</p></li>
                      <li><p><i class="fi-telephone"></i>telephone</p></li>
                      <li><p><i class="fi-mail"></i>email</p></li>
                    </ul>                </div>
                <div class=" small-12 medium-12 large-4 columns align-middle">
                    <blockquote class="quote">
                        <p>Outside of a dog, a book is a man's best friend.</p>
                        <p>Inside of a dog it's too dark to read.</p>
                        <cite>Groucho Marx</cite>
                    </blockquote>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="row">
                <div class="large-12 columns text-center align-middle">
                    <ul class="no-bullet inline-dot-list">
                        <li><a href="../../../../index.html">London</a></li>
                        <li><a href="../../../../projects.html">Vancouver</a></li>
                        <li><a href="../../../../books.html">Tokyo</a></li>
                        <li><a href="../../../../screenshots.html">Beijing</a></li>
                        <li><a href="../../../../index.html">Hong Kong</a></li>
                        <li><a href="../../../../projects.html">Kuala Lumpur</a></li>
                        <li><a href="../../../../books.html">Singapore</a></li>
                        <li><a href="../../../../screenshots.html">Tuktoyaktuk</a></li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</footer><script src="../../../../assets/js/app.js"></script>

</body>

</html>